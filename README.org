#+TITLE: amp.el
#+AUTHOR: Keegan Carruthers-Smith
#+AUTHOR: Amp <amp@ampcode.com>

An unofficial Emacs client for Amp's IDE mode.

Ported from [[https://github.com/sourcegraph/amp.nvim][amp.nvim]]. Inspired by [[https://github.com/manzaltu/claude-code-ide.el][claude-code-ide.el]].

* Status

Complete rewrite based on amp.nvim architecture. Actively dogfooding and will
publish a proper version (likely on the Sourcegraph org) at some point.

Do not trust this documentation yet, it was written by Amp and not validated
by a human yet.

Implements the same IDE protocol as amp.nvim, providing:
- Selection tracking (cursor position and visual regions)
- Visible files tracking across windows
- Diagnostics integration (Flymake)
- File read/edit operations
- Message sending to Amp agent

* Usage

1. Load the package:
#+begin_src elisp
(load-file "amp.el")
#+end_src

2. Start the Amp server:
#+begin_src elisp
M-x amp-start
#+end_src

Or enable =amp-mode= for automatic startup:
#+begin_src elisp
(amp-mode 1)
#+end_src

3. Launch Amp in another terminal:
#+begin_src shell
amp --ide
#+end_src

4. Open a file and move your cursor - Amp will track your selection automatically.

* What Works

- WebSocket server with lockfile-based discovery
- Selection tracking (cursor and visual regions)
- Visible files tracking across all windows
- Diagnostics integration (Flymake)
- File reading and editing via Amp
- Message sending (userSentMessage, appendToPrompt)
- Automatic cleanup on Emacs exit

* What Doesn't

- Authentication (websocket library limitation)
- Multiple workspace folders (only tracks current directory)

* Requirements

- Emacs 27.1+
- =websocket= package (1.14+)
- Amp CLI that supports =--ide= flag

* Commands

| Command              | Purpose                                    |
|----------------------+--------------------------------------------|
| =amp-start=          | Start Amp WebSocket server                 |
| =amp-stop=           | Stop Amp WebSocket server                  |
| =amp-status=         | Show server status and connection info     |
| =amp-send-message=   | Send a message to the Amp agent            |
| =amp-send-region=    | Send selected region to Amp agent          |
| =amp-send-to-prompt= | Append text to Amp prompt field            |
| =amp-mode=           | Toggle global Amp mode (auto-start server) |

* Configuration

#+begin_src elisp
;; Customize log level (trace, debug, info, warn, error)
(setq amp-log-level 'info)

;; Enable auto-start when amp-mode is enabled
(setq amp-auto-start t)

;; Enable amp-mode globally
(amp-mode 1)
#+end_src

* Debugging

View logs in the =*amp-log*= buffer to see connection status, selection changes,
and any errors. The log level can be controlled via =amp-log-level=.
